<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.swygbro.packup.notification.mapper.UserTemplateNoticeMapper">

    <select id="selectNoticeTargetList" resultType="com.swygbro.packup.notification.vo.UserTemplateNoticeVo">
        SELECT TEMPLATE_NO,
               TEMPLATE_NM,
               USER_NO,
               USER_ID,
               DEL_YN,
               REPEAT_TYPE,
               ALARM_DT,
               ALARM_TIME,
               ALARM_TEXT,
               SLACK_YN
          FROM TBL_USER_TEMPLATE
         WHERE  DEL_YN = 'N'
           AND (
                  (REPEAT_TYPE = 'FALSE'
                   AND DATE_FORMAT(ALARM_DT, '%Y-%m-%d %H:%i') = #{alarmDt})
                OR
                  (REPEAT_TYPE = 'TRUE'
                   AND FIND_IN_SET(UPPER(DATE_FORMAT(NOW(), '%a')), ALARM_REPEAT_DAY) > 0
                   AND DATE_FORMAT(ALARM_TIME, '%H:%i') = #{alarmTime})
                )
    </select>

</mapper>